<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>MARKETING DIGITAL / DIGITAL MARKETING</title>
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Special Elite', monospace;
    background-color: black;
    color: white;
    max-width: 1000px;
    margin: 50px auto;
    padding: 20px;
    background-image: url('logo.png'); /* t≈Ço ze sta≈Çym logo */
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
  }

  h1 {
    text-align: center;
    margin-bottom: 40px;
    color: #F8AC10;
  }

  .player {
    margin-bottom: 40px;
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .karaoke-line {
    white-space: nowrap;
    font-size: 28px;
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .word {
    transition: color 0.2s;
  }

  .highlight-es {
    color: #F8AC10; /* stare zdania */
  }

  .highlight-z {
    color: #c63843; /* nowe zdania */
  }

  .completed {
    color: #9b835a; /* po zako≈Ñczeniu wszystkie zdania w brƒÖzie */
  }

  .audio-container {
    display: flex;
    align-items: center;
    justify-content: flex-start;
  }

  button {
    font-family: 'Special Elite', monospace;
    background: #F8AC10;
    border: 1px solid white;
    color: white;
    cursor: pointer;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    font-size: 22px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-right: 15px;
    flex-shrink: 0;
  }

  .time, .progress {
    display: none;
  }
</style>
</head>
<body>

<h1>MARKETING DIGITAL / DIGITAL MARKETING</h1>

<div id="players"></div>

<script>
/**
 * Zmodyfikowana funkcja loadKaraoke
 * - Nie tworzy ju≈º nowego elementu 'playerDiv'.
 * - Wstawia tre≈õƒá bezpo≈õrednio do przekazanego elementu 'container'.
 * - Dodaje klasƒô 'player' do elementu 'container'.
 */
async function loadKaraoke(audioFile, jsonFile, container, type) {
  try {
    const res = await fetch(jsonFile);
    if (!res.ok) throw new Error(`No se encontr√≥ ${jsonFile}`);
    const data = await res.json();

    // üí° ZMIANA: Kontener zosta≈Ç ju≈º utworzony i wstawiony do DOM,
    // wystarczy dodaƒá mu klasƒô 'player'.
    container.className = 'player'; 

    const controlsDiv = document.createElement('div');
    controlsDiv.className = 'audio-container';

    const playBtn = document.createElement('button');
    playBtn.textContent = '‚ñ∂';
    controlsDiv.appendChild(playBtn);

    const karaokeDiv = document.createElement('div');
    karaokeDiv.className = 'karaoke-line';

    const wordsArray = [];

    data.forEach((item) => {
      const words = item.text.split(' ');
      // Konwersja formatu czasu 'min:sek' na sekundy
      const start = parseFloat(item.start.split(':').reduce((acc, time) => 60 * acc + +time));
      const end = parseFloat(item.end.split(':').reduce((acc, time) => 60 * acc + +time));
      const duration = end - start;
      const wordDuration = duration / words.length;

      words.forEach((word, j) => {
        const span = document.createElement('span');
        span.textContent = word;
        span.dataset.start = (start + j * wordDuration).toFixed(2);
        span.dataset.end = (start + (j + 1) * wordDuration).toFixed(2);
        span.dataset.type = type; 
        span.className = 'word';
        karaokeDiv.appendChild(span);
        wordsArray.push(span);
      });
    });

    // üí° ZMIANA: Do≈ÇƒÖczamy kontrolki i karaokeDiv bezpo≈õrednio do przekazanego kontenera (container)
    container.appendChild(controlsDiv);
    container.appendChild(karaokeDiv);

    const audio = document.createElement('audio');
    audio.src = audioFile;

    let rafId = null;
    let completed = false;

    function highlightLoop() {
      const t = audio.currentTime;

      wordsArray.forEach(span => {
        const start = parseFloat(span.dataset.start);
        const end = parseFloat(span.dataset.end);
        span.classList.remove('highlight-es', 'highlight-z');
        if(t >= start && t <= end){
          span.classList.add(span.dataset.type === 'z' ? 'highlight-z' : 'highlight-es');
        }
      });

      if(t >= audio.duration){
        completed = true;
        wordsArray.forEach(span => span.classList.remove('highlight-es', 'highlight-z'));
        wordsArray.forEach(span => span.classList.add('completed'));
        playBtn.textContent = '‚ñ∂';
        cancelAnimationFrame(rafId);
        rafId = null;
      } else if(!audio.paused) {
        rafId = requestAnimationFrame(highlightLoop);
      }
    }

    playBtn.addEventListener('click', () => {
      if(completed){
        wordsArray.forEach(span => { 
          span.classList.remove('completed', 'highlight-es', 'highlight-z');
        });
        audio.currentTime = 0;
        completed = false;
      }

      if(audio.paused){
        audio.play();
        playBtn.textContent = '‚ùö‚ùö';
        if(!rafId) rafId = requestAnimationFrame(highlightLoop);
      } else {
        audio.pause();
        playBtn.textContent = '‚ñ∂';
        if(rafId){ cancelAnimationFrame(rafId); rafId = null; }
      }
    });

    audio.addEventListener('ended', () => {
      completed = true;
      wordsArray.forEach(span => span.classList.remove('highlight-es', 'highlight-z'));
      wordsArray.forEach(span => span.classList.add('completed'));
      playBtn.textContent = '‚ñ∂';
      if(rafId){ cancelAnimationFrame(rafId); rafId = null; }
    });

  } catch (err) {
    console.error('Error al cargar karaoke:', err);
    // W przypadku b≈Çƒôdu, mo≈ºesz chcieƒá usunƒÖƒá pusty kontener lub dodaƒá komunikat o b≈Çƒôdzie
    container.innerHTML = `<span style="color: #c63843;">B≈ÅƒÑD: Nie mo≈ºna za≈Çadowaƒá ${audioFile.split('/').pop()}</span>`;
  }
}

// ----------------------------------------------------
// LOGIKA ZAPEWNIAJƒÑCA STA≈ÅƒÑ KOLEJNO≈öƒÜ W DOM
// ----------------------------------------------------

const playersContainer = document.getElementById('players');
const tasks = []; // Tablica do zbierania obietnic ≈Çadowania (do r√≥wnoleg≈Çego wykonania)

// Sta≈Ça kolejno≈õƒá: para 001, para 002, ..., para 030
for (let i = 1; i <= 30; i++) {
    const num = i.toString().padStart(3,'0');

    // 1. Tworzymy i wstawiamy do DOM pusty kontener dla STAREGO zdania (ES)
    const esPlayerContainer = document.createElement('div');
    esPlayerContainer.id = `player-es-${num}`;
    playersContainer.appendChild(esPlayerContainer); // üöÄ SYNCHRONICZNE WSTAWIENIE

    // Dodaj asynchroniczne zadanie ≈Çadowania tre≈õci do listy
    tasks.push(loadKaraoke(
        `https://raw.githubusercontent.com/xpanol/PLAYERS/main/${num}_es.mp3`,
        `https://raw.githubusercontent.com/xpanol/PLAYERS/main/${num}_es.json`,
        esPlayerContainer, // Wype≈Çnij ju≈º wstawiony kontener
        'es'
    ));

    // 2. Tworzymy i wstawiamy do DOM pusty kontener dla NOWEGO zdania (EN)
    const enPlayerContainer = document.createElement('div');
    enPlayerContainer.id = `player-en-${num}`;
    playersContainer.appendChild(enPlayerContainer); // üöÄ SYNCHRONICZNE WSTAWIENIE

    // Dodaj asynchroniczne zadanie ≈Çadowania tre≈õci do listy
    tasks.push(loadKaraoke(
        `https://raw.githubusercontent.com/xpanol/PLAYERS/main/Z${num}_en.mp3`,
        `https://raw.githubusercontent.com/xpanol/PLAYERS/main/Z${num}_en.json`,
        enPlayerContainer, // Wype≈Çnij ju≈º wstawiony kontener
        'z'
    ));
}

// Uruchomienie wszystkich zada≈Ñ ≈Çadowania r√≥wnolegle (bez blokowania)
Promise.all(tasks).catch(err => console.error('B≈ÇƒÖd podczas ≈Çadowania wszystkich karaoke:', err));
</script>

</body>
</html>