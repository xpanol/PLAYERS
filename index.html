<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>MARKETING DIGITAL / DIGITAL MARKETING</title>
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Special Elite', monospace;
    background-color: black;
    background-image: url('logo.png'); /* tło strony */
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
    color: white;
    max-width: 1000px;
    margin: 50px auto;
    padding: 20px;
  }

  h1 {
    text-align: center;
    font-family: 'Special Elite', monospace;
    margin-bottom: 40px;
    color: #F8AC10;
  }

  .player {
    margin-bottom: 40px;
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .karaoke-line {
    white-space: nowrap;
    font-size: 28px;
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .word {
    transition: color 0.2s;
  }

  .highlight {
    color: #F8AC10;
  }

  .completed {
    color: #9b835a;
  }

  .audio-container {
    display: flex;
    align-items: center;
    justify-content: flex-start;
  }

  button {
    font-family: 'Special Elite', monospace;
    background: #F8AC10;
    border: 1px solid white;
    color: white;
    cursor: pointer;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    font-size: 22px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-right: 15px;
    flex-shrink: 0;
  }

  .time, .progress {
    display: none;
  }

  /* Pasek ładowania */
  #loading-container {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    height: 30px;
    background-color: #333;
    border-radius: 15px;
    overflow: hidden;
    display: flex;
    align-items: center;
    z-index: 999;
  }

  #loading-bar {
    height: 100%;
    width: 0;
    background-color: #F8AC10;
    position: relative;
  }

  #loading-logo {
    position: absolute;
    top: 50%;
    left: 0;
    transform: translate(-50%, -50%);
    height: 28px;
  }
</style>
</head>
<body>

<h1>MARKETING DIGITAL / DIGITAL MARKETING</h1>

<div id="loading-container">
  <div id="loading-bar">
    <img src="logo.png" id="loading-logo" alt="logo">
  </div>
</div>

<div id="players">
  <script>
    for(let i=1;i<=30;i++){
      const div = document.createElement('div');
      div.id = 'player-' + i.toString().padStart(3,'0');
      document.getElementById('players').appendChild(div);
    }
  </script>
</div>

<script>
let loadedCount = 0;

async function loadKaraoke(audioFile, jsonFile, containerId) {
  try {
    const res = await fetch(jsonFile);
    if(!res.ok) throw new Error(`No se encontró ${jsonFile}`);
    const data = await res.json();

    const playerDiv = document.getElementById(containerId);
    playerDiv.className = 'player';

    const controlsDiv = document.createElement('div');
    controlsDiv.className = 'audio-container';

    const playBtn = document.createElement('button');
    playBtn.textContent = '▶';
    controlsDiv.appendChild(playBtn);

    const karaokeDiv = document.createElement('div');
    karaokeDiv.className = 'karaoke-line';

    const wordsArray = [];

    data.forEach((item) => {
      const words = item.text.split(' ');
      const start = parseFloat(item.start.split(':').reduce((acc,time)=>60*acc + +time));
      const end = parseFloat(item.end.split(':').reduce((acc,time)=>60*acc + +time));
      const duration = end - start;
      const wordDuration = duration / words.length;

      words.forEach((word,j)=>{
        const span = document.createElement('span');
        span.textContent = word;
        span.dataset.start = (start + j*wordDuration).toFixed(2);
        span.dataset.end = (start + (j+1)*wordDuration).toFixed(2);
        span.className = 'word';
        karaokeDiv.appendChild(span);
        wordsArray.push(span);
      });
    });

    playerDiv.appendChild(controlsDiv);
    playerDiv.appendChild(karaokeDiv);

    const audio = document.createElement('audio');
    audio.src = audioFile;

    let rafId = null;
    let completed = false;

    function highlightLoop(){
      const t = audio.currentTime;
      wordsArray.forEach(span=>{
        const start = parseFloat(span.dataset.start);
        const end = parseFloat(span.dataset.end);
        span.classList.remove('highlight');
        if(t>=start && t<=end) span.classList.add('highlight');
      });
      if(t>=audio.duration){
        completed = true;
        wordsArray.forEach(span=>span.classList.remove('highlight'));
        wordsArray.forEach(span=>span.classList.add('completed'));
        playBtn.textContent = '▶';
        cancelAnimationFrame(rafId);
        rafId=null;
      } else if(!audio.paused){
        rafId=requestAnimationFrame(highlightLoop);
      }
    }

    playBtn.addEventListener('click',()=>{
      if(completed){
        wordsArray.forEach(span=>{
          span.classList.remove('completed');
          span.classList.remove('highlight');
        });
        audio.currentTime=0;
        completed=false;
      }

      if(audio.paused){
        audio.play();
        playBtn.textContent='❚❚';
        if(!rafId) rafId=requestAnimationFrame(highlightLoop);
      } else {
        audio.pause();
        playBtn.textContent='▶';
        if(rafId){ cancelAnimationFrame(rafId); rafId=null; }
      }
    });

    audio.addEventListener('ended',()=>{
      completed=true;
      wordsArray.forEach(span=>span.classList.remove('highlight'));
      wordsArray.forEach(span=>span.classList.add('completed'));
      playBtn.textContent='▶';
      if(rafId){ cancelAnimationFrame(rafId); rafId=null; }
    });

    // Aktualizacja paska ładowania
    loadedCount++;
    const progress = loadedCount/30;
    const bar = document.getElementById('loading-bar');
    bar.style.width = (progress*100) + '%';

    const logo = document.getElementById('loading-logo');
    // logo na początku paska i przesuwane wraz z szerokością paska
    logo.style.left = (progress*100) + '%';

    if(loadedCount===30){
      setTimeout(()=>{
        document.getElementById('loading-container').style.display='none';
      },500);
    }

  } catch(err){
    console.error('Error al cargar karaoke:',err);
  }
}

const files = Array.from({length:30},(_,i)=>i+1);
files.forEach(i=>{
  const num=i.toString().padStart(3,'0');
  const audioFile=`https://raw.githubusercontent.com/xpanol/PLAYERS/main/${num}_es.mp3`;
  const jsonFile=`https://raw.githubusercontent.com/xpanol/PLAYERS/main/${num}_es.json`;
  loadKaraoke(audioFile,jsonFile,'player-'+num);
});
</script>

</body>
</html>
