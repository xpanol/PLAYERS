<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>MARKETING DIGITAL / DIGITAL MARKETING</title>
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Special Elite', monospace;
    background-color: black;
    color: white;
    max-width: 1000px;
    margin:50px auto;
    padding: 20px;
  }

  h1 {
    text-align: center;
    font-family: 'Special Elite', monospace;
    margin-bottom: 40px;
    color: #F6B511;
  }

  .player {
    margin-bottom: 40px;
    display: flex;
    align-items: flex-start;
    gap: 15px;
  }

  .word {
    font-size: 28px;
    padding: 2px;
    transition: color 0.2s;
  }

  .highlight {
    color: #F6B511;
  }

  .karaoke-line {
    white-space: nowrap;
    display: flex;
    align-items: center;
  }

  .audio-container {
    display: flex;
    align-items: center;
  }

  button {
    font-family: 'Special Elite', monospace;
    background: #F6B511;
    border: 1px solid white;
    color: white;
    cursor: pointer;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    font-size: 22px;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
  }

  .time, .progress {
    display: none;
  }
</style>
</head>
<body>

<h1>MARKETING DIGITAL / DIGITAL MARKETING</h1>

<div id="players">
  <!-- Generowanie 30 odtwarzaczy statycznie -->
  <script>
  for (let i = 1; i <= 30; i++) {
    const num = i.toString().padStart(3, '0');
    document.write(`
      <div class="player">
        <div class="audio-container">
          <button onclick="playAudio('${num}')">▶</button>
          <audio id="audio${num}" src="mp3/ES/${num}_es.mp3" preload="metadata" playsinline></audio>
        </div>
        <div class="karaoke-line" id="karaoke${num}"></div>
      </div>
    `);
  }
  </script>
</div>

<script>
// Wczytywanie JSON dla wszystkich odtwarzaczy w tle
for (let i = 1; i <= 30; i++) {
  const num = i.toString().padStart(3, '0');
  const karaokeDiv = document.getElementById(`karaoke${num}`);
  const jsonFile = `json/ES/${num}_es.json`;

  fetch(jsonFile)
    .then(res => res.ok ? res.json() : Promise.reject(`Nie znaleziono ${jsonFile}`))
    .then(data => {
      data.forEach(item => {
        const words = item.text.split(' ');
        const start = parseFloat(item.start.split(':').reduce((acc, t) => 60 * acc + +t));
        const end = parseFloat(item.end.split(':').reduce((acc, t) => 60 * acc + +t));
        const duration = end - start;
        const wordDuration = duration / words.length;

        words.forEach((word, j) => {
          const span = document.createElement('span');
          span.textContent = word + ' ';
          span.dataset.start = (start + j * wordDuration).toFixed(2);
          span.dataset.end = (start + (j + 1) * wordDuration).toFixed(2);
          span.className = 'word';
          karaokeDiv.appendChild(span);
        });
      });
      karaokeDiv.dataset.loaded = 'true';
    })
    .catch(err => console.error('Błąd wczytywania JSON:', err));
}

// Funkcja odtwarzania audio
function playAudio(num) {
  const audioEl = document.getElementById(`audio${num}`);
  const karaokeDiv = document.getElementById(`karaoke${num}`);

  audioEl.currentTime = 0;
  audioEl.play().catch(err => console.warn('Safari zablokowało odtwarzanie:', err));

  audioEl.ontimeupdate = () => {
    karaokeDiv.querySelectorAll('.word').forEach(span => {
      const start = parseFloat(span.dataset.start);
      const end = parseFloat(span.dataset.end);
      if (audioEl.currentTime >= start && audioEl.currentTime <= end) {
        span.classList.add('highlight');
      } else {
        span.classList.remove('highlight');
      }
    });
  };
}
</script>

</body>
</html>
