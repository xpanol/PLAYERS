<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>MARKETING DIGITAL / DIGITAL MARKETING</title>
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: 'Special Elite', monospace;
  background-color: black;
  color: white;
  max-width: 1000px;
  margin: 50px auto;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 20px;
  color: #F8AC10;
}

/* Buttons container */
#buttonsContainer {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-bottom: 30px;
}

/* Główne przyciski pod tytułem */
#playAllButton, #resetAllButton {
  font-family: 'Special Elite', monospace;
  background: #F8AC10;
  border: 1px solid white;
  color: black;
  cursor: pointer;
  width: 160px;
  height: 45px;
  border-radius: 5px;
  font-size: 16px;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* Przyciski dla pojedynczych playerów - okrągłe */
.player button {
  font-family: 'Special Elite', monospace;
  background: #F8AC10;
  border: 1px solid white;
  color: black;
  cursor: pointer;
  width: 45px;
  height: 45px;
  border-radius: 50%;
  font-size: 25px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-right: 15px;
  flex-shrink: 0;
}

.player {
  margin-bottom: 40px;
  display: flex;
  align-items: center;
  gap: 15px;
  cursor: pointer;
}

.karaoke-line {
  white-space: nowrap;
  font-size: 28px;
  display: flex;
  align-items: center;
  gap: 16px;
  justify-content: center;
  text-align: center;
}

.word { transition: color 0.2s; }
.highlight-es { color: #F8AC10; }
.highlight-z { color: #c63843; }
.completed { color: #9b835a; }

.audio-container {
  display: flex;
  align-items: center;
  justify-content: flex-start;
}

/* Modal */
#fullscreenModal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0; top: 0;
  width: 100%;
  height: 100%;
  background: black;
  color: white;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
  box-sizing: border-box;
}

#fullscreenModal .karaoke-line {
  font-size: 48px;
  text-align: center;
  gap: 24px;
  flex-wrap: wrap;
  max-width: 90%;
  margin: 0 auto 30px auto;
  white-space: pre-wrap;
  justify-content: center;
}

.fullscreen-audio-wrapper {
  margin-top: 25px;
  display: flex;
  justify-content: center;
  gap: 30px; /* standardowy odstęp desktop */
}

#fullscreenAudio::-webkit-media-controls-play-button,
#fullscreenAudio::-webkit-media-controls-panel {
  display: none !important;
  opacity: 0 !important;
}

#fullscreenAudio { width: 0; height: 0; opacity: 0; }

/* === ZMIANA MODAL BUTTONS DESKTOP === */
#modalPlayButton {
  font-family: 'Special Elite', monospace;
  background: #F8AC10;
  border: 1px solid white;
  color: black;
  cursor: pointer;
  width: 65px;
  height: 65px;
  border-radius: 50%;
  font-size: 32px;
  display: flex;
  justify-content: center;
  align-items: center;
}

#modalPrevButton, #modalNextButton {
  font-family: 'Special Elite', monospace;
  background: #F8AC10;
  border: 1px solid white;
  color: black;
  cursor: pointer;
  width: 60px;   
  height: 60px;  
  border-radius: 50%;
  font-size: 32px;  
  display: flex;
  justify-content: center;
  align-items: center;
}
/* === KONIEC ZMIANY MODAL BUTTONS DESKTOP === */

#fullscreenClose {
  position: absolute;
  top: 20px;
  right: 20px;
  font-family: 'Special Elite', monospace;
  background: #F8AC10;
  border: 1px solid white;
  color: black;
  cursor: pointer;
  font-size: 24px;
  border-radius: 5px;
  padding: 5px 10px;
}

#fullscreenContent {
  width: 100%;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}

/* === ZMIANA MODAL BUTTONS MOBILE W WIDOKU PIONOWYM === */
@media (max-width: 480px) and (orientation: portrait) {
  #fullscreenModal { padding: 0; }
  #fullscreenModal .karaoke-line { font-size: 34px; padding: 0 10px; }
  
  /* POWIĘKSZONE PRZYCISKI W MOBILE */
  #modalPlayButton { width: 100px; height: 100px; font-size: 40px; flex-shrink: 0; margin-bottom: 30px; }
  #modalPrevButton, #modalNextButton { width: 100px; height: 100px; font-size: 40px; flex-shrink: 0; }
  .fullscreen-audio-wrapper { gap: 70px; } /* większy odstęp między przyciskami w mobile */
}
/* === KONIEC ZMIANY MODAL BUTTONS MOBILE === */

</style>
</head>
<body>

<h1>MARKETING DIGITAL / DIGITAL MARKETING</h1>

<div id="buttonsContainer">
  <button id="playAllButton">▶ REPRODUCIR TODO / PLAY ALL</button>
  <button id="resetAllButton">RESET ALL</button>
</div>

<div id="players"></div>

<!-- Modal -->
<div id="fullscreenModal" aria-hidden="true">
  <button id="fullscreenClose">✖</button>
  <div id="fullscreenContent"></div>
  <div class="fullscreen-audio-wrapper">
    <button id="modalPrevButton">◀</button>
    <button id="modalPlayButton">▶</button>
    <button id="modalNextButton">▶</button>
    <audio id="fullscreenAudio"></audio>
  </div>
</div>

<script>
// JS pozostaje bez zmian
const playerControls = [];
let isPlayingAll = false;
let currentTrackIndex = 0;
let currentAudioPlaying = null;
let pausedAllTime = 0;

const modal = document.getElementById('fullscreenModal');
const modalContent = document.getElementById('fullscreenContent');
const modalClose = document.getElementById('fullscreenClose');
const modalAudio = document.getElementById('fullscreenAudio');
const modalPlayButton = document.getElementById('modalPlayButton');
const modalPrevButton = document.getElementById('modalPrevButton');
const modalNextButton = document.getElementById('modalNextButton');

let highlightRaf = null;
function stopHighlight(){ if(highlightRaf){ cancelAnimationFrame(highlightRaf); highlightRaf=null; } }
function startHighlightForAudio(audio, spans){
  stopHighlight();
  function loop(){
    const t = audio.currentTime || 0;
    spans.forEach(span=>{
      const s = parseFloat(span.dataset.start);
      const e = parseFloat(span.dataset.end);
      span.classList.remove('highlight-es','highlight-z');
      if(!isNaN(s)&&!isNaN(e)&&t>=s&&t<=e){ span.classList.add(span.dataset.type==='z'?'highlight-z':'highlight-es'); }
    });
    highlightRaf = requestAnimationFrame(loop);
  }
  highlightRaf=requestAnimationFrame(loop);
}

const playersContainer = document.getElementById('players');
const order = [];
for(let i=1;i<=30;i++){
  const num=i.toString().padStart(3,'0');
  order.push({audio:`https://raw.githubusercontent.com/xpanol/PLAYERS/main/${num}_es.mp3`, json:`https://raw.githubusercontent.com/xpanol/PLAYERS/main/${num}_es.json`, type:'es'});
  order.push({audio:`https://raw.githubusercontent.com/xpanol/PLAYERS/main/Z${num}_en.mp3`, json:`https://raw.githubusercontent.com/xpanol/PLAYERS/main/Z${num}_en.json`, type:'z'});
}

// cała reszta JS pozostaje bez zmian
async function loadKaraoke(audioFile, jsonFile, container, type){
  try{
    const res = await fetch(jsonFile);
    if(!res.ok) throw new Error('No JSON');
    const data = await res.json();

    const playerDiv = document.createElement('div'); playerDiv.className='player';
    const controlsDiv = document.createElement('div'); controlsDiv.className='audio-container';
    const playBtn = document.createElement('button'); playBtn.textContent='▶';
    controlsDiv.appendChild(playBtn);
    const karaokeDiv=document.createElement('div'); karaokeDiv.className='karaoke-line';

    const wordsArray=[];
    data.forEach(item=>{
      const words=item.text.split(' ');
      const start=item.start.split(':').reduce((a,t)=>60*a+ +t,0);
      const end=item.end.split(':').reduce((a,t)=>60*a+ +t,0);
      const dur=end-start; const wdur=dur/words.length;
      words.forEach((w,j)=>{
        const span=document.createElement('span');
        span.textContent=w+' ';
        span.dataset.start=(start+j*wdur).toFixed(2);
        span.dataset.end=(start+(j+1)*wdur).toFixed(2);
        span.dataset.type=type;
        span.className='word';
        karaokeDiv.appendChild(span);
        wordsArray.push(span);
      });
    });

    playerDiv.appendChild(controlsDiv); playerDiv.appendChild(karaokeDiv); container.appendChild(playerDiv);

    const audio=document.createElement('audio'); audio.src=audioFile;
    audio.onplay=()=>{ startHighlightForAudio(audio, wordsArray); currentAudioPlaying=audio; };
    audio.onpause=()=>{ stopHighlight(); };
    audio.onended=()=>{ wordsArray.forEach(s=>s.classList.add('completed')); stopHighlight(); playBtn.textContent='▶'; if(isPlayingAll){ currentTrackIndex++; playNextTrack(); } };

    playBtn.onclick=()=>{ showModalAndPlay(order.findIndex(o=>o.audio===audioFile)); };

    playerControls.push({playBtn,audio,wordsArray});
  }catch(e){ console.error(e); }
}

async function loadAllSequentially(){for(const item of order) await loadKaraoke(item.audio,item.json,playersContainer,item.type);}
loadAllSequentially();

function stopCurrentAudio(){ if(currentAudioPlaying) { currentAudioPlaying.pause(); currentAudioPlaying=null; stopHighlight(); } }

function showModalAndPlay(index){
  currentTrackIndex=index;
  const item=order[index];
  modal.style.display='flex'; modal.setAttribute('aria-hidden','false');
  modalContent.innerHTML='';
  const clone=document.createElement('div'); clone.className='karaoke-line';

  fetch(item.json).then(r=>r.json()).then(data=>{
    const spans=[];
    data.forEach(it=>{
      const words=it.text.split(' ');
      const start=it.start.split(':').reduce((a,t)=>60*a+ +t,0);
      const end=it.end.split(':').reduce((a,t)=>60*a+ +t,0);
      const dur=end-start; const wdur=dur/words.length;
      words.forEach((w,j)=>{
        const span=document.createElement('span');
        span.textContent=w+' ';
        span.dataset.start=(start+j*wdur).toFixed(2);
        span.dataset.end=(start+(j+1)*wdur).toFixed(2);
        span.dataset.type=item.type;
        span.className='word';
        clone.appendChild(span);
        spans.push(span);
      });
    });
    modalContent.appendChild(clone);

    stopCurrentAudio();
    modalAudio.pause();
    modalAudio.src=item.audio; modalAudio.currentTime=0; modalAudio.load();

    modalAudio.onplay=()=>{ modalPlayButton.textContent='❚❚'; startHighlightForAudio(modalAudio, spans); currentAudioPlaying=modalAudio; };
    modalAudio.onpause=()=>{ modalPlayButton.textContent='▶'; stopHighlight(); };
    modalAudio.onended=()=>{ spans.forEach(s=>s.classList.add('completed')); modalPlayButton.textContent='▶'; stopHighlight(); };

    modalPrevButton.onclick=()=>{ if(currentTrackIndex>0){ showModalAndPlay(currentTrackIndex-1); modalPlayButton.textContent='▶'; } };
    modalNextButton.onclick=()=>{ if(currentTrackIndex<order.length-1){ showModalAndPlay(currentTrackIndex+1); modalPlayButton.textContent='▶'; } };

    modalPlayButton.onclick=()=>{ 
      if(modalAudio.paused){ spans.forEach(s=>s.classList.remove('highlight-es','highlight-z','completed')); modalAudio.currentTime=0; modalAudio.play(); }
      else{ modalAudio.pause(); }
    };
  });
}

modalClose.onclick=()=>{ modalAudio.pause(); stopHighlight(); modal.style.display='none'; modal.setAttribute('aria-hidden','true'); };

const playAllBtn=document.getElementById('playAllButton');
function playNextTrack(){
  if(currentTrackIndex<playerControls.length && isPlayingAll){
    const track=playerControls[currentTrackIndex];
    stopCurrentAudio();
    track.audio.currentTime = pausedAllTime || 0;
    track.audio.play().catch(()=>{ currentTrackIndex++; playNextTrack(); });
    track.playBtn.textContent='❚❚';
    track.audio.onended=()=>{
      track.wordsArray.forEach(s=>s.classList.add('completed'));
      stopHighlight();
      pausedAllTime=0;
      currentTrackIndex++;
      playNextTrack();
    };
    currentAudioPlaying = track.audio;
  } else { isPlayingAll=false; playAllBtn.textContent='▶ REPRODUCIR TODO / PLAY ALL'; }
}
playAllBtn.onclick=()=>{
  if(isPlayingAll){
    isPlayingAll=false;
    if(currentAudioPlaying) pausedAllTime = currentAudioPlaying.currentTime;
    if(currentAudioPlaying) currentAudioPlaying.pause();
    playAllBtn.textContent='▶ REPRODUCIR TODO / PAUSE';
  } else { isPlayingAll=true; playAllBtn.textContent='❚❚ DETENER / PAUSE'; playNextTrack(); }
};
document.getElementById('resetAllButton').onclick = () => location.reload();
</script>
</body>
</html>