<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PLAYERS</title>
<style>
    body {
        background: #f4f1ec;
        font-family: Arial, sans-serif;
        color: #9b835a;
        padding: 20px;
    }

    .sentence {
        margin-bottom: 25px;
        padding: 15px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .text {
        font-size: 20px;
        margin-bottom: 8px;
        color: inherit;
    }

    .highlight-new {
        color: #c63843;
    }

    audio {
        width: 100 percent;
        margin-top: 10px;
    }
</style>
</head>
<body>

<div id="content"></div>

<script>
// Lista zdań według Twojej kolejności
const sentences = [
    { es: "001_es.mp3", en: "Z001_en.mp3", json: "Z001_en.json" },
    { es: "002_es.mp3", en: "Z002_en.mp3", json: "Z002_en.json" },
    { es: "003_es.mp3", en: "Z003_en.mp3", json: "Z003_en.json" },
    { es: "004_es.mp3", en: "Z004_en.mp3", json: "Z004_en.json" }
];

// RAW base URL
const BASE = "https://raw.githubusercontent.com/xpanol/PLAYERS/main/";

async function loadKaraoke(container, audioFile, jsonFile, isNew) {
    const audio = document.createElement("audio");
    audio.controls = true;
    audio.src = BASE + audioFile;

    const text = document.createElement("div");
    text.className = "text";
    text.textContent = "...";

    container.appendChild(text);
    container.appendChild(audio);

    let words = [];

    try {
        const data = await fetch(BASE + jsonFile).then(r => r.json());
        words = data;
    } catch (e) {
        text.textContent = "(brak danych JSON)";
        return;
    }

    audio.addEventListener("timeupdate", () => {
        const current = audio.currentTime;
        let active = words.find(w => current >= w.start && current <= w.end);

        if (active) {
            text.textContent = active.word;
            if (isNew) text.classList.add("highlight-new");
        }
    });

    audio.addEventListener("ended", () => {
        text.style.color = "#9b835a";
        text.classList.remove("highlight-new");
    });
}

async function init() {
    const content = document.getElementById("content");

    for (let i = 0; i < sentences.length; i++) {
        const block = document.createElement("div");
        block.className = "sentence";

        const esFile = sentences[i].es;
        const enFile = sentences[i].en;
        const jsonFile = sentences[i].json;

        await loadKaraoke(block, esFile, jsonFile, false);
        await loadKaraoke(block, enFile, jsonFile, true);

        content.appendChild(block);
    }
}

init();
</script>

</body>
</html>
